<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %> 
    <!-- If you would like to add new css link -->
    <link rel="stylesheet" href="/styles/register.css">
</head>
<body>
    <%- include('partials/header.ejs') %> 
    <main>
        <div class="login-img"></div>
        <div class="form-container">
            <form action="users/register" method="post" autocomplete="off">
                <h1 class="title">Create Account</h1>
                <div class="form-controller title">
                    <label for="name">Name</label>
                    <input type="text" name="name" placeholder="Type your name" />
                    <div id="name" class="error"></div>
                </div>
                <div class="form-controller title">
                    <label for="fname">Surname</label>
                    <input type="text" name="surname" placeholder="Type your surname" />
                    <div id="surname" class="error"></div>
                </div>
                <div class="form-controller title">
                    <label for="email">Email</label>
                    <input type="text" name="email" placeholder="Type your email" />
                    <div id="email" class="error"></div>
                </div>
                <div class="form-controller title">
                    <label for="password">Password</label>
                    <input type="password" name="password" placeholder="Type your password" />
                    <div id="password" class="error"></div>
                </div>
                <input type="submit" class="title" />
            </form>
        </div>
    </main>

    <script>
        const form = document.querySelector('form')
        const nameError = document.querySelector('#name')
        const surnameError = document.querySelector('#surname')
        const emailError = document.querySelector('#email')
        const passwordError = document.querySelector('#password')
        
        form.addEventListener("submit", async (e) => {
           e.preventDefault();

           emailError.textContent = "";
           passwordError.textContent = "";
           nameError.textContent = "";
           surnameError.textContent = "";

           emailError.style.display = "none"
           passwordError.style.display = "none"
           nameError.style.display = "none"
           surnameError.style.display = "none"

           const email = form.email.value
           const password = form.password.value
           const name = form.name.value
           const surname = form.surname.value
           try {
              const res = await fetch('users/register', {
                 method: "POST",
                 body: JSON.stringify({ name, surname, email, password }),
                 headers: { "Content-Type": "application/json" }
              })
              const data = await res.json();
              if (data) {
                 if (data.email) {
                    emailError.textContent = data.email
                    emailError.style.display = "block"
                 }
                 if (data.password) {
                    passwordError.textContent = data.password
                    passwordError.style.display = "block"
                 }
                 if (data.name) {
                    nameError.textContent = data.name
                    nameError.style.display = "block"
                 }
                 if (data.surname) {
                    surnameError.textContent = data.surname
                    surnameError.style.display = "block"
                 }
              }
              if(data.user){
                location.assign("/login")
              }
           } catch (err) {
              console.log("ERR::", err)
           }
        })
    </script>

    <script src="/scripts/animate.js"></script>
</body>
</html>